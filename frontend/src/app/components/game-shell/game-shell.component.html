<div *ngIf="state$ | async as state" class="game-wrapper">
  <header class="game-header">
    <div class="stat">Round: <strong>{{ state.round }} / {{ state.maxRounds }}</strong></div>
    <div class="stat">Score: <strong>{{ state.score }}</strong></div>
    <div class="stat" *ngIf="state.gameMode === 'timed'">Time: <strong>00:45</strong></div>
  </header>

  <main class="game-grid" *ngIf="state.currentPhoto; else loading">
    <div class="photo-section">
      <div class="image-container">
        <img [src]="state.currentPhoto?.imageUrl" alt="Guess the location and year" />
      </div>
      <p class="hint" *ngIf="state.currentPhoto?.description">Hint: {{ state.currentPhoto?.description }}</p>
    </div>

    <div class="interaction-section">
      <div id="map" class="map-container">
        <p class="map-placeholder">Map Loading...</p>
      </div>

      <div class="controls">
        <div class="input-group">
          <label>Year:</label>
          <input
            type="number"
            placeholder="YYYY"
            [(ngModel)]="guessedYear"
            [disabled]="state.status !== 'in-progress'"
          />
        </div>

        <button class="guess-btn" (click)="onSubmitGuess()" [disabled]="guessedYear === null || state.status !== 'in-progress'">
          SUBMIT GUESS
        </button>

        <button class="secondary-btn" type="button" (click)="onNextRound()" [disabled]="state.status !== 'in-progress'">
          Next Round
        </button>

        <div class="result" *ngIf="state.lastResult">
          <p>
            You guessed <strong>{{ state.lastResult.guessedYear }}</strong> and the answer was
            <strong>{{ state.lastResult.actualYear }}</strong>.
          </p>
          <p>Difference: {{ state.lastResult.yearDifference }} years | Points: +{{ state.lastResult.pointsAwarded }}</p>
        </div>
      </div>
    </div>
  </main>

  <ng-template #loading>
    <div class="loading">Loading round...</div>
  </ng-template>

  <div class="game-footer" *ngIf="state.status === 'finished'">
    <p>Game finished! Final score: <strong>{{ state.score }}</strong></p>
    <button class="guess-btn" type="button" (click)="onRestart(state)">Play again</button>
  </div>
</div>
