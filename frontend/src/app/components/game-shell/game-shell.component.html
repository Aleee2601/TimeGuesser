<div class="game-container-split" *ngIf="state$ | async as state">
  <button class="exit-button" type="button" (click)="openExitConfirm()">Exit</button>

  <!-- LEFT COLUMN: PHOTO -->
  <div class="split-col photo-col">
    <!-- Header Stats (Overlay or Top) -->
    <header class="game-header-simple">
      <div class="stat">Round: <strong>{{ state.round }} / {{ state.maxRounds }}</strong></div>
      <div class="stat">Score: <strong>{{ state.score }}</strong></div>
      <div class="stat" *ngIf="state.gameMode === 'timed'">Time: <strong
          [style.color]="timeLeft < 10 ? '#ef4444' : 'inherit'">00:{{ timeLeft | number:'2.0-0' }}</strong></div>
    </header>

    <div class="photo-frame">
      <img *ngIf="!photoLoadFailed; else fallbackImage" [src]="state.currentPhoto?.imageUrl" class="game-photo"
        alt="Guess location and year" (error)="onImageError()" />
      <ng-template #fallbackImage>
        <div class="img-fallback">
          <img src="assets/images/placeholder.jpg" alt="No Image" style="display:none"> <!-- Optional logic -->
          <div class="icon">üñºÔ∏è</div>
          <p>Image Unavailable</p>
        </div>
      </ng-template>
    </div>

    <!-- Hint Section (Below Photo) -->
    <div class="hint-section-below">
      <button *ngIf="!hintVisible" class="btn-hint-flat" (click)="toggleHint()">Show Hint</button>
      <div class="hint-box-flat" *ngIf="hintVisible && state.currentPhoto?.description">
        {{ state.currentPhoto?.description }}
      </div>
    </div>
  </div>

  <!-- RIGHT COLUMN: INTERACTION -->
  <div class="split-col interaction-col">

    <!-- Map Section (Top of Right Col) -->
    <div class="map-section">
      <app-map [interactive]="state.status === 'in-progress' && !state.lastResult" [targetLocation]="targetLocation"
        [guessedLocation]="selectedLocation" [resetKey]="state.round"
        (guess)="onMapGuess($event)"></app-map>
    </div>

    <!-- Controls Section (Bottom of Right Col) -->
    <div class="controls-section">
      <label class="section-label">GUESS THE YEAR</label>

      <div class="slider-row">
        <span>1900</span>
        <input type="number" class="year-input-large" placeholder="YYYY" [(ngModel)]="guessedYear"
          [disabled]="state.status !== 'in-progress'" />
        <span>2024</span>
      </div>

      <button class="btn-submit" (click)="onSubmitGuess()"
        [disabled]="guessedYear === null || state.status !== 'in-progress'">
        SUBMIT GUESS
      </button>


    </div>
  </div>

  <ng-template #loading>
    <div class="loading-overlay">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>
  </ng-template>

  <!-- Round Result Overlay -->
  <div class="result-overlay" *ngIf="state.lastResult">
    <div class="result-card">
      <h3>Round {{ state.round }} Complete</h3>
      <div class="points">+{{ state.lastResult.pointsAwarded }} Points</div>

      <div style="margin: 1rem 0; color: var(--text-muted);">
        <p>Guessed: <strong>{{ state.lastResult.guessedYear }}</strong></p>
        <p>Actual: <strong>{{ state.lastResult.actualYear }}</strong></p>
      </div>

      <button class="btn-next" (click)="onNextRound()">Next Round ‚Üí</button>
    </div>
  </div>

  <!-- Game Over -->
  <div class="game-over-overlay" *ngIf="state.status === 'finished'">
    <div class="game-over-card">
      <h2>Game Complete!</h2>
      <div class="final-score">{{ state.score }}</div>
      <button class="btn-submit" (click)="onRestart(state)">Play Again</button>
      <a routerLink="/" class="btn-link">Back to Menu</a>
    </div>
  </div>

  <!-- Exit Confirm Overlay -->
  <div class="exit-overlay" *ngIf="exitConfirmVisible">
    <div class="exit-card">
      <p>Are you sure you want to exit?</p>
      <div class="exit-actions">
        <button class="btn-exit btn-exit-yes" type="button" (click)="confirmExit()">Yes</button>
        <button class="btn-exit btn-exit-cancel" type="button" (click)="cancelExitConfirm()">Cancel</button>
      </div>
    </div>
  </div>
</div>
